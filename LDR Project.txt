/*services */
#include "STD_TYPES.h"
#include "BIT_MATH.h"
/*MCAL */
#include "DIO.h"
#include "ADC_Interface.h"
#include "TMR0_interface.h"
/*HAL */
#include "LCD_Int.h"
#include "KEYPAD_Cfg.h"
#include "KEYPAD_Interface.h"
#include "TMR1_interface.h"
#include "SRVM_interface.h"
#define F_CPU 16000000
#include <util/delay.h>

int main(void)
{
	u8 limit=0;
	u8 level=0;
	u16 adc=0;
	u8 key=0;
	Port_Init();
	TMR0_Init ();
	TMR0_Start();
	TMR0_SetDutyCycle(0);
	ADC_INIT(VREF_AVCC,ADC_SCALER_128);
	LCD_Init();
	KEYPAD_Init();
	
	LCD_SendString("Threshold(%):");
    while (key!='C')
    {
	    key=KEYPAD_GetKey();
	    if (key!=NO_KEY && key!='C')
	    {
		    limit=10*limit+(key-'0');
		    LCD_WriteChar(key);
		    key=NO_KEY;
	    }
    }
	LCD_WriteChar('%');
  	while (1)
  	{
      adc=ADC_ReadChannel(CH_0);
  	  level=(adc/10)-4;   
	if (level>=97)
	{
		level+=3;
	}
	  LCD_SendString("                ");
	  LCD_SendXY(2,0);
	  LCD_SendString("LDR Level(%):");
	  LCD_SendNumber(level);
	  LCD_WriteChar('%');
  	  if (level <=limit)
  	  {
  		  TMR0_SetDutyCycle(0);
  	  }
  	   else
  	   {
  		   TMR0_SetDutyCycle(level);
  	   }
  	}
    

}
